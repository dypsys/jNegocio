<?xml version="1.0" encoding="UTF-8"?>

<project name="Compress JavaScript" default="compress" basedir=".">
	<property name="BUILD_DIR"      value="../" />
	<property name="SOURCE_DIR"     value="." />
	<property name="YUI_COMPRESSOR" value="${SOURCE_DIR}/bin/yuicompressor-2.4.7.jar" />
		
	<target name="compress" depends="clean, bundle_javascript, compress_javascript" />
	
	<target name="bundle_javascript">
      	<!-- create the output directory for built files -->
      	<mkdir dir="${BUILD_DIR}" />
      	<echo>Bundle JavaScript Files...</echo>
      		
	    <concat destfile="${BUILD_DIR}/nec.backend.all.js">
	        <filelist dir="${SOURCE_DIR}/" 
                          files="
                            nec.utils.table.js, 
                            nec.backend.js, 
                            nec.taxes.js, 
                            nec.usergroups.js,
                            nec.currencies.js,
                            nec.backend.product.prices.js,  
                            nec.backend.product.attributes.js,                         
                            nec.backend.common.js, 
                            nec.backend.formlist.js, 
                            utils.js"/>
	    </concat>
	    <echo>JavaScript Bundles Done!!!</echo>
	</target>
	
	<target name="compress_javascript" depends="bundle_javascript">
		<echo>Compressing JavaScript Files...</echo>
	    <apply executable="java" parallel="false">
	        <filelist dir="${BUILD_DIR}" files="nec.backend.all.js" />
	        <arg line="-jar" />
	        <arg path="${YUI_COMPRESSOR}" />
	        <srcfile />
	        <arg line="-o" />
	        <mapper type="glob" from="*.js" to="${BUILD_DIR}/*.min.js" />
	        <targetfile />
	    </apply>
	</target>
	
	<target name="clean">
		<echo>Delete old build folder...</echo>
		<delete dir="build" />
		<echo>Create new build folder...</echo>
		<mkdir dir="${BUILD_DIR}"/>
	</target>	
</project>