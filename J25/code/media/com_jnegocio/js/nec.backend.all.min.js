Class.Occlude=new Class({occlude:function(c,b){b=document.id(b||this.element);var a=b.retrieve(c||this.property);if(a&&!$defined(this.occluded)){return this.occluded=a}this.occluded=false;b.store(c||this.property,this);return this.occluded}});var jNegocioHtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"jNegocioHtmlTable",initialize:function(){var a=Array.link(arguments,{options:Object.type,table:Element.type});this.setOptions(a.options);this.element=a.table||new Element("table",this.options.properties);if(this.occlude()){return this.occluded}this.build()},build:function(){this.element.store("jNegocioHtmlTable",this);this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element);$$(this.body.rows);if(this.options.headers.length){this.setHeaders(this.options.headers)}else{this.thead=document.id(this.element.tHead)}if(this.thead){this.head=document.id(this.thead.rows[0])}if(this.options.footers.length){this.setFooters(this.options.footers)}this.tfoot=document.id(this.element.tFoot);if(this.tfoot){this.foot=document.id(this.tfoot.rows[0])}this.options.rows.each(function(a){this.push(a)},this);["adopt","inject","wraps","grab","replaces","dispose"].each(function(a){this[a]=this.element[a].bind(this.element)},this)},toElement:function(){return this.element},empty:function(){this.body.empty();return this},set:function(d,a){var c=(d=="headers")?"tHead":"tFoot";this[c.toLowerCase()]=(document.id(this.element[c])||new Element(c.toLowerCase()).inject(this.element,"top")).empty();var b=this.push(a,{},this[c.toLowerCase()],d=="headers"?"th":"td");if(d=="headers"){this.head=document.id(this.thead.rows[0])}else{this.foot=document.id(this.thead.rows[0])}return b},setHeaders:function(a){this.set("headers",a);return this},setFooters:function(a){this.set("footers",a);return this},push:function(e,b,d,a){if($type(e)=="element"&&e.get("tag")=="tr"){e.inject(d||this.body);return{tr:e,tds:e.getChildren("td")}}var c=e.map(function(h){var j=new Element(a||"td",h?h.properties:{}),g=(h?h.content:"")||h,f=document.id(g);if($type(g)!="string"&&f){j.adopt(f)}else{if($type(g)!="string"){j.adopt(h)}else{j.set("html",g)}}return j});return{tr:new Element("tr",b).inject(d||this.body).adopt(c),tds:c}}});var Negocio=Negocio||{};Negocio={};window.addEvent("domready",function(){Negocio.utils=new Negocio.utils.App()});var Negocio=Negocio||{};Negocio.taxes={};Negocio.taxes.App=new Class({Implements:[Events,Options],taxes:[],options:{taxes:[],defaulttypetax:"",defaulttax:""},initialize:function(a){this.setOptions(a);this.addTaxes(this.options.taxes)},addTaxes:function(a){$$(a).each(function(b){var c=new Negocio.Tax(b);this.addTax(c)},this)},addTax:function(a){this.taxes[a.id]=a},getTax:function(a){return this.taxes[a]},setdefaultTypeTax:function(a){this.options.defaulttypetax=a;this.options.defaulttax=this.findtaxbytypetax(a)},setdefaultTax:function(a){this.options.defaulttax=a},getdefaultTax:function(){return this.options.defaulttax},findtaxbytypetax:function(a){var b=0;this.taxes.each(function(d,c){if(d.typetaxid==a){b=c}});return b}});Negocio.Tax=new Class({Implements:[Options],id:0,tax_rate:0,typetaxid:0,initialize:function(b,a){this.setOptions(a);$each(b,function(d,c){this[c]=d}.bind(this))}});var Negocio=Negocio||{};Negocio.usergroups={};Negocio.usergroups.App=new Class({Implements:[Events,Options],usergroups:[],options:{usergroups:[],defaultUsergroupId:""},initialize:function(a){this.setOptions(a);this.addUserGroups(this.options.usergroups)},addUserGroups:function(a){$$(a).each(function(b){var c=new Negocio.UserGroup(b);this.addUserGroup(c)},this)},addUserGroup:function(a){this.usergroups[a.id]=a},getUserGroup:function(a){return this.usergroups[a]},setDefaultUserGroupID:function(a){this.options.defaultUsergroupId=a},getDefaultUserGroupID:function(){return this.options.defaultUsergroupId},getUserGroups:function(){return this.usergroups}});Negocio.UserGroup=new Class({Implements:[Options],id:0,name:0,initialize:function(b,a){this.setOptions(a);$each(b,function(d,c){this[c]=d}.bind(this))}});var Negocio=Negocio||{};Negocio.currencies={};Negocio.currencies.App=new Class({Implements:[Events,Options],currencies:[],options:{editor:null,currencies:[],defaultcurrency:""},initialize:function(a){this.setOptions(a);this.addCurrencies(this.options.currencies)},addCurrencies:function(a){$$(a).each(function(b){var c=new Negocio.Currency(b);this.currencies[c.id]=c},this)},addCurrency:function(a){this.currencies[a.id]=a},getCurrency:function(a){return this.currencies[a]},getjQueryFormating:function(b){var a=this.currencies[b];var c="{aNeg: '-', pSign: 's', mDec: "+a.decimals+", aSep: '"+a.thousands_separator+"', aDec: '"+a.decimal_separator+"', aSign: '"+a.symbol+"' }";return c},getdefaultCurrency:function(){return this.options.defaultcurrency},setdefaultCurrency:function(a){this.options.defaultcurency=a}});Negocio.Currency=new Class({Implements:[Options],initialize:function(b,a){this.setOptions(a);$each(b,function(d,c){this[c]=d}.bind(this))}});var Negocio=Negocio||{};Negocio.productprices={};Negocio.productprices.App=new Class({Implements:[Events,Options],options:{elementtable:"",work_pricewithtax:0,image_path:"",priceFormat:{aNeg:"-",pSign:"s",mDec:2,aSep:",",aDec:".",aSign:" â‚¬"},percentFormat:{aNeg:"-",pSign:"s",mDec:2,aSep:",",aDec:".",aSign:" %",vMin:"0.00",vMax:"100"},quantityFormat:{aNeg:"-",pSign:"",mDec:0,aSep:",",aDec:".",aSign:"",vMin:"0.00",vMax:"999999"},dateformat:"%Y-%m-%d"},tablePrices:null,initialize:function(a){this.setOptions(a);this.tablePrices=new jNegocioHtmlTable(document.id(this.options.elementtable))},eventcalculteprice:function(k){var a=k||window.event;if(a.stop){a.stop()}a.preventDefault();var g=a.target.getParent().getParent().getAttribute("rel");var p="price"+g;var b="priceincltax"+g;var h="dto"+g;var c="total"+g;var o=Negocio.taxes.getTax(Negocio.taxes.getdefaultTax());var n=parseFloat(jQuery("#"+p).autoNumeric("get"));var f=n+(n*parseFloat(o.tax_rate)/100);var d=parseFloat(jQuery("#"+h).autoNumeric("get"));var l=(n*d)/100;var j=n-l;var m=(j*((100+parseFloat(o.tax_rate))/100));jQuery("#"+b).autoNumeric("set",f);jQuery("#"+c).autoNumeric("set",m)},eventcalcultepricewithtax:function(k){var a=k||window.event;if(a.stop){a.stop()}a.preventDefault();var g=a.target.getParent().getParent().getAttribute("rel");var q="price"+g;var b="priceincltax"+g;var h="dto"+g;var c="total"+g;var p=Negocio.taxes.getTax(Negocio.taxes.getdefaultTax());var o=parseFloat(jQuery("#"+b).autoNumeric("get"));var n=o/((100+parseFloat(p.tax_rate))/100);var d=parseFloat(jQuery("#"+h).autoNumeric("get"));var m=(n*d)/100;var j=n-m;var f=j*((100+parseFloat(p.tax_rate))/100);var l=n*((100+parseFloat(p.tax_rate))/100);jQuery("#"+q).autoNumeric("set",n);jQuery("#"+c).autoNumeric("set",l)},calculatetotalpricewithtax:function(d,f){var c=Negocio.taxes.getTax(Negocio.taxes.getdefaultTax());var e=d/((100+parseFloat(c.tax_rate))/100);var b=(e*f)/100;var a=e-b;return(a*((100+parseFloat(c.tax_rate))/100))},calculatetotalprice:function(d,f){var c=Negocio.taxes.getTax(Negocio.taxes.getdefaultTax());var e=parseFloat(d);var b=(e*f)/100;var a=e-b;return(a*((100+parseFloat(c.tax_rate))/100))},erase:function(d){var c=d||window.event;if(c.stop){c.stop()}c.preventDefault();var f=d.target.getParent().getParent().getParent();var b=c.target.getParent().getAttribute("rel");var a="pp_deleted_"+b;if($(a)){$(a).value=1}f.setStyle("display","none")},addPrice:function(){var t=this.tablePrices.body.rows.length;var u="ppid"+t;var n="pp_deleted_"+t;var d="price"+t;var q="priceincltax"+t;var j="total"+t;var o="dto"+t;var h="qntstart"+t;var f="qntend"+t;var e="group_"+t;var r="prdprices_delete_"+t;var k=0;var c=[];var m=new Element("div");var l=new Element("input",{id:u,type:"hidden",name:"prdprices["+t+"][productprice_id]",value:"0"});var b=new Element("input",{id:n,type:"hidden",name:"prdprices["+t+"][deleted]",value:"0"});m.grab(l);m.grab(b);c[k]=m;k=k+1;if(this.options.work_pricewithtax==1){c[k]=new Element("input",{id:d,type:"text",name:"prdprices["+t+"][price]","class":"classPrice",value:"0",readonly:"readonly"});k=k+1;c[k]=new Element("input",{id:q,type:"text",name:"prdprices["+t+"][priceincltax]","class":"classPrice",value:"0"});k=k+1}else{c[k]=new Element("input",{id:d,type:"text",name:"prdprices["+t+"][price]","class":"classPrice",value:"0"});k=k+1;c[k]=new Element("input",{id:q,type:"text",name:"prdprices["+t+"][priceincltax]","class":"classPrice",value:"0",readonly:"readonly"});k=k+1}c[k]=new Element("input",{id:o,type:"text",name:"prdprices["+t+"][discount]","class":"classProcent",value:"0"});k=k+1;c[k]=new Element("input",{id:j,type:"text",name:"prdprices["+t+"][total]","class":"classPrice necReadonly",value:"0",readonly:"readonly"});k=k+1;c[k]=new Element("input",{id:h,type:"text",name:"prdprices["+t+"][qntstart]","class":"classQuantity",value:"0"});k=k+1;c[k]=new Element("input",{id:f,type:"text",name:"prdprices["+t+"][qntend]","class":"classQuantity",value:"999999"});k=k+1;var p=new Element("select",{id:e,name:"prdprices["+t+"][group_id]","class":"inputbox select_usrgrp"});Negocio.usergroups.usergroups.each(function(w,v){p.grab(new Element("option",{value:w.id,text:w.name}))});c[k]=p;k=k+1;var a=new Element("a",{href:"#","class":"pp_delete_node",id:r,rel:t});var s=new Element("img",{id:"idelete"+t,src:this.options.image_path+"16/remove.png"});a.adopt(s);c[k]=a;k=k+1;var g="row"+(t%2);this.tablePrices.push(c,{"class":g,rel:t});$(d).addEvent("blur",this.eventcalculteprice);$(d).addEvent("keyup",this.eventcalculteprice);$(q).addEvent("blur",this.eventcalcultepricewithtax);$(q).addEvent("keyup",this.eventcalcultepricewithtax);if(this.options.work_pricewithtax==1){$(o).addEvent("blur",this.eventcalcultepricewithtax);$(o).addEvent("keyup",this.eventcalcultepricewithtax)}else{$(o).addEvent("blur",this.eventcalculteprice);$(o).addEvent("keyup",this.eventcalculteprice)}$(r).addEvent("click",this.erase);jQuery("#"+d).autoNumeric("init",this.options.priceFormat);jQuery("#"+q).autoNumeric("init",this.options.priceFormat);jQuery("#"+j).autoNumeric("init",this.options.priceFormat);jQuery("#"+o).autoNumeric("init",this.options.percentFormat);jQuery("#"+f).autoNumeric("init",this.options.quantityFormat);jQuery("#"+f).autoNumeric("init",this.options.quantityFormat);if(this.options.work_pricewithtax==1){$(q).focus()}else{$(d).focus()}}});Negocio.common={};Negocio.common.App=new Class({Implements:[Events,Options],options:{locale:"en-GB"},initialize:function(a){this.setOptions(a);Locale.use(this.options.locale);this.common()},common:function(){if($("system-message")){this.hide($("system-message"))}},hide:function(b,a){if(!a){a=4000}setTimeout(function(){b.tween("opacity",0)},a);setTimeout(function(){b.morph({height:0,margin:0})},a+400);setTimeout(function(){b.destroy()},a+800)}});function jFWUpdatePage(){location.reload(true)}Negocio.formlist={};Negocio.formlist.App=new Class({Extends:Negocio.common.App,Implements:[Options,Events],options:{idForm:"adminForm"},initialize:function(a){this.parent(a);this.formularioList()},formularioList:function(){var a=this;if($(this.options.idForm)){$$(".nec_action_clearfilters").addEvent("click",function(b){a.clearfilters()});$$(".nec_action_applyfilters").addEvent("click",function(b){$(this.options.idForm).submit()})}},clearfilters:function(){$$(".necFilter").each(function(a){a.setProperty("value","")});$(this.options.idForm).submit()}});var Negocio=Negocio||{};Negocio.utils={};Negocio.utils.App=new Class({Implements:[Events,Options],tvalue:"",options:{},initialize:function(a){this.setOptions(a)},loadElements_Form_toArray:function(a){var b=new Array();for(i=0;i<a.elements.length;i++){if(a.elements[i].name=="_token"){this.tvalue=a.elements[i].value}else{postvar={name:a.elements[i].name,value:a.elements[i].value,checked:a.elements[i].checked,id:a.elements[i].id};b[i]=postvar}}return b}});